
\NeedsTeXFormat{LaTeX2e}

\input{abakos.def}
\CVSExtract$Id: abakos.sty,v 0.1 2021/05/06 15:08:25 A L Exp $
\CVSPackage{abakos}{} %substitui \ProvidesPackage (replaces \ProvidesPackage)

% Pacotes de codificação das fontes para português
\usepackage[T1]{fontenc}
\usepackage{times}
\usepackage[
colorlinks=false,  % não pinta o texto
pdfborder={0 0 0}  % remove a borda azul dos links
]{hyperref}

% \usepackage{memhfixc}  % Para mudança de tamanho de fontes 
% Merge em duas células (linhas diferentes)
\usepackage{eso-pic} % para sobrepor conteúdo a cada página
\usepackage{multirow}

\usepackage{paracol} % colunas independentes que quebram entre páginas

%desenhar cabeçalho e rodapé
\usepackage{fancyhdr}
\pagestyle{fancy}


% Pacote para divisão silábica do portugues
\usepackage[english, brazilian]{babel}
\usepackage[titles]{tocloft} %% formatar a lista de figuras e tabelas.
\usepackage[format=hang,font=bf,justification=centerlast,labelfont=bf,labelsep=endash]{caption}
%para usar o citador
%  \usepackage{selinput}
% 
%   \SelectInputMappings{     % Semi-automatic input selection
	%     atilde={ã},             % by a list of selected glyphs
	%     aacute={á},             % see: http://partners.adobe.com/public/developer/en/opentype/glyphlist.txt
	%     ccedilla={ç}
	%   }
% \usepackage{babel}
% \usepackage{txfonts}      % Font in Times New Roman style
\usepackage[onehalfspacing]{setspace}
\usepackage{lipsum}       % Only for dummy text, to be dropped in actual document


% Pacote para citação e referências seguindo ABNT no sistema (AUTOR, Data)
\usepackage[alf,abnt-emphasize=bf,bibjustif,recuo=0cm, abnt-etal-cite=3, abnt-full-initials=no, abnt-and-type=;, abnt-thesis-year=both, abnt-etal-text=it]{abntex2cite} % faz ficar negrito i titulo e a o ano da thesi vir depois do titulo

%\usepackage[alf,abnt-emphasize=bf, abnt-etal-cite=2, abnt-full-initials=yes]{abntcite} % faz ficar negrito i titulo e a o ano da thesi vir depois do titulo

%\usepackage[alf]{abntex2cite}
% \usepackage{cite}
%\usepackage{abnt-alf}
\usepackage{setspace}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}

\citeoption{abnt-full-initials=yes}


\usepackage[linesnumbered, ruled, vlined]{algorithm2e}
\usepackage{algorithmic} %algorithm
\usepackage{listings}

\usepackage{leading}   %espaçamento variavel
\newcommand{\esp}{\hspace{-0.3cm}} % espaço entre Numero e Título da seção

% Alterar o espaçamento da margem no algoritmo
\setlength{\algomargin}{1em}

% Margens 
% \usepackage[inner=30mm,outer=20mm,top=30mm,bottom=20mm]{geometry}
\usepackage{geometry}
\geometry{tmargin=20mm,bmargin=20mm,lmargin=15mm,rmargin=15mm}

% -- Legenda das Figuras --
\usepackage{caption}
\captionsetup[figure]{labelsep=endash,labelfont={bf},textfont=bf} 
\captionsetup[table]{labelsep=endash,labelfont={bf},textfont=bf}


%%%%%%Utilizar simbolos como nota de rodapé [* 
\long\def\symbolfootnote[#1]#2{\begingroup%
	\def\thefootnote{\fnsymbol{footnote}}\footnote[#1]{#2}\endgroup}

%%%%%%%%%% Identação de nota de rodapé %%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[stable]{footmisc}
\renewcommand{\footnotemargin}{0pt} %identação da nota de rodapé 
\renewcommand{\footnotelayout}{\hspace{0px}}% Espaço entre simbolo do rodapé e layout texto 

% Preambulo: adicionar pacotes
\usepackage{tikz}
\usetikzlibrary{calc}  
\usepackage[most]{tcolorbox}
\usepackage{atbegshi}
\usepackage{ifthen}
\usepackage{pgffor}

\usepackage{xstring}
\usepackage{xparse}
\usepackage{etoolbox}
\usepackage{pgffor}  % já deve estar incluso se você usou foreach antes

% Definir cor do fundo (exemplo da segunda imagem)
\definecolor{headerblue}{HTML}{1b253a} % Azul escuro
\definecolor{headergray}{HTML}{e5e6e7} % Cinza escuro


% Inicialmente, define \logoLicenca como vazio
\newcommand{\logoLicenca}{}
\newcommand{\licencaUrl}{}

% Define o comando \tipoLicenca para setar \logoLicenca corretamente
\newcommand{\tipoLicenca}[1]{%
	\ifthenelse{\equal{#1}{CC-BY}}{%
		\renewcommand{\logoLicenca}{template/licencas/cc-by.png}%
		\renewcommand{\licencaUrl}{https://creativecommons.org/licenses/by/4.0/}%
	}{}%
	\ifthenelse{\equal{#1}{CC-BY-SA}}{%
		\renewcommand{\logoLicenca}{template/licencas/cc-by-sa.png}%
		\renewcommand{\licencaUrl}{https://creativecommons.org/licenses/by-sa/4.0/}%
	}{}%
	\ifthenelse{\equal{#1}{CC-BY-NC}}{%
		\renewcommand{\logoLicenca}{template/licencas/cc-by-nc.png}%
		\renewcommand{\licencaUrl}{https://creativecommons.org/licenses/by-nc/4.0/}%
	}{}%
	\ifthenelse{\equal{#1}{CC-BY-ND}}{%
		\renewcommand{\logoLicenca}{template/licencas/cc-by-nd.png}%
		\renewcommand{\licencaUrl}{https://creativecommons.org/licenses/by-nd/4.0/}%
	}{}%
	\ifthenelse{\equal{#1}{CC-BY-NC-SA}}{%
		\renewcommand{\logoLicenca}{template/licencas/cc-by-nc-sa.png}%
		\renewcommand{\licencaUrl}{https://creativecommons.org/licenses/by-nc-sa/4.0/}%
	}{}%
	\ifthenelse{\equal{#1}{CC-BY-NC-ND}}{%
		\renewcommand{\logoLicenca}{template/licencas/cc-by-nc-nd.png}%
		\renewcommand{\licencaUrl}{https://creativecommons.org/licenses/by-nc-nd/4.0/}%
	}{}%
}

% Logo da revista
\newcommand{\logoRevista}{}
\newcommand{\checkForUpdatesUrl}{}

\newcommand{\setLogoRevista}[1]{\renewcommand{\logoRevista}{#1}}
\newcommand{\setCheckForUpdatesUrl}[1]{\renewcommand{\checkForUpdatesUrl}{#1}}

\newcommand{\iconOrcid}{\includegraphics[height=1em]{template/orcid.png}}

%%%%%%%%%%%%%%%

\newcommand{\afiliacao}[2]{% id, texto
	\expandafter\gdef\csname afil#1\endcsname{#2}
}

\newcommand{\autoresLista}{} % inicializa
\newcommand{\autor}[4]{% nome, sobrenome, id_afil, orcid
	\gappto{\autoresLista}{#1/#2/#3/#4,}
}

\newcommand{\emailCorrespondencia}[1]{%
	\gdef\emailAutorResponsavel{#1}
}

\newcounter{numautor}

\newcommand{\renderAutores}{%
	\begingroup
	\renewcommand{\arraystretch}{1.2}
	\newcommand{\virgula}{}%
	
	% Primeira linha - nomes com sobrescrito e ORCID
	\foreach \autorEntry in \autoresLista {%
		\ifx\autorEntry\empty\else
		\StrBefore{\autorEntry}{/}[\nome]%
		\StrBehind{\autorEntry}{/}[\restoA]%
		\StrBefore{\restoA}{/}[\sobrenome]%
		\StrBehind{\restoA}{/}[\restoB]%
		\StrBefore{\restoB}{/}[\idafil]%
		\StrBehind{\restoB}{/}[\orcid]%
		
		\textbf{\nome~\sobrenome}$^{\idafil}$\ \href{\orcid}{\iconOrcid}\par
		\fi
	}
	
	\vspace{1em}
	
	% Afiliações
	\foreach \autorEntry in \autoresLista {%
		\ifx\autorEntry\empty\else
		\StrBefore{\autorEntry}{/}[\nome]%
		\StrBehind{\autorEntry}{/}[\restoA]%
		\StrBefore{\restoA}{/}[\sobrenome]%
		\StrBehind{\restoA}{/}[\restoB]%
		\StrBefore{\restoB}{/}[\idafil]%
		\expandafter\ifx\csname usedafil\idafil\endcsname\relax
		$^{\idafil}$ \csname afil\idafil\endcsname\par
		\expandafter\gdef\csname usedafil\idafil\endcsname{1}%
		\fi
		\fi
	}
	\endgroup
}

%%%%%%%%%%%%%%%

\renewcommand{\autoresLista}{} % inicializa

% nome, sobrenome, id_afil, orcid
\renewcommand{\autor}[4]{%
	\gappto{\autoresLista}{#1/#2/#3/#4,}%
}

% Geração da parte do "Como citar"
\newcommand{\renderComoCitarAutores}{%
	\begingroup
	\def\autoresComoCitar{}%
	\foreach \autorEntry in \autoresLista {%
		\ifx\autorEntry\empty\else
		\StrBefore{\autorEntry}{/}[\nome]%
		\StrBehind{\autorEntry}{/}[\restoA]%
		\StrBefore{\restoA}{/}[\sobrenome]%
		\xdef\autoresComoCitar{\autoresComoCitar \MakeUppercase{\sobrenome}, \nome; }%
		\fi
	}%
	\StrGobbleRight{\autoresComoCitar}{2}[\autoresFinal]%
	\autoresFinal.%
	\endgroup
}



%%%%%%%%%%%%%%%

% estilo sem cabeçalho/rodapé para as páginas de capa
\fancypagestyle{capavazia}{%
	\fancyhf{}%
	\renewcommand{\headrulewidth}{0pt}%
	\renewcommand{\footrulewidth}{0pt}%
}

% precisa do tikz: \usepackage{tikz}
\newif\ifcapa@ativa
\AddToHook{shipout/background}{%
	\ifcapa@ativa
	\begin{tikzpicture}[remember picture,overlay]
		% faixa colada na direita cobrindo a página inteira
		\fill[headergray]
		([xshift=-.27\paperwidth]current page.north east) rectangle
		(current page.south east);
	\end{tikzpicture}%
	\fi
}

\newenvironment{revistaheaderenv}{%
	\clearpage
	\pagestyle{capavazia}
	\newgeometry{left=15mm,right=0mm,top=0mm,bottom=0mm,includefoot,footskip=24pt}%
	\capa@ativatrue 
	\columnratio{0.70,0.30}% esquerda 72% / direita 28%
	\begin{paracol}{2}%
		\setlength{\columnsep}{0mm}%
	}{%
	\end{paracol}%
	
	\restoregeometry       % volta à geometria normal
	\thispagestyle{fancy}  % garante rodapé nesta primeira página
	\pagestyle{fancy}      % e nas seguintes
	\clearpage             % começa a página do artigo
	\capa@ativafalse       % desativa o overlay ANTES do shipout
}

\makeatletter
\let\ps@plain\ps@fancy
\makeatletter

\newcommand{\revistaheader}{%
	\begin{revistaheaderenv}
		
		% ===== Coluna DIREITA PRIMEIRO (para começar no topo) =====
		\switchcolumn*   % muda para a direita no mesmo nível vertical
		\begin{tcolorbox}[enhanced,breakable,
			frame hidden, interior hidden, % sem borda e sem fundo
			colback=headergray,colframe=headergray,
			%boxrule=0pt,arc=0pt,
			left=8pt,right=12pt,top=40pt,bottom=53pt]
			\textbf{\MakeUppercase{\secaoNome}}\\[0.25em]
			\textbf{Editor responsável pelo artigo: } \editorNome\\[0.75em]
			
			\textbf{Recebido em}\\ \dataRecebido\\
			\textbf{Aprovado em}\\ \dataAprovado\\
			\textbf{Publicado em}\\ \dataPublicado\\[0.5em]
			
			\textbf{PID}\\ \pidArtigo\\[0.75em]
			
			\href{\licencaUrl}{\includegraphics[width=3cm]{\logoLicenca}}\\[0.75em]
			
			\textbf{Texto padrão da Licença}\\ \textoLicenca\\[0.75em]
			\textbf{Declaração de Copyright}\\ \textoCopyright\\[0.75em]
			\textbf{Contribuição dos autores segundo a Taxonomia CRediT}\\ \textoCRediT\\[1.25em]
			
			\textbf{Conflito de interesses}\\ \textoConflito\\[0.75em]
			
			\textbf{Fonte de financiamento}\\ \textoFinanciamento
			
			\vfill\null
		\end{tcolorbox}
		
		% ===== Agora volte para a ESQUERDA e escreva todo o conteúdo =====
		\switchcolumn
		\begin{tcolorbox}[enhanced,breakable,
			colback=white,colframe=headergray,boxrule=0pt,arc=0pt,
			left=0pt,right=0pt,top=40pt,bottom=40pt]
			
			% topo: logo + botão
			\noindent
			\begin{minipage}[t]{0.75\linewidth}
				\includegraphics[width=\linewidth]{\logoRevista}
			\end{minipage}%
			\hfill
			\begin{minipage}[t]{0.22\linewidth}
				\vspace*{-4.8cm}%
				\href{\checkForUpdatesUrl}{\includegraphics[width=\linewidth]{figuras/botao-check.png}}
			\end{minipage}
			
			\vspace{1cm}
			
			{\Large\bfseries \monog}\\[0.5em]
			\ifdefined\monogIngles \monogIngles\\[0.5em]\fi
			\ifdefined\monogEspanhol \monogEspanhol\\[1em]\fi
			
			\vspace{0.5em}
			\renderAutores
			\begin{flushright}\footnotesize
				\textbf{Correspondência para:} \emailAutorResponsavel
			\end{flushright}
			
			\ifdefined\resumoPT
			\vspace{2em}\noindent\textbf{Resumo:} \resumoPT\\[0.3em]
			\noindent \textbf{Palavras-chave:} \keywordsPT
			\fi
			
			\ifdefined\resumoEN
			\vspace{2em}\noindent\textbf{Abstract:} \resumoEN\\[0.3em]
			\noindent \textbf{Keywords:} \keywordsEN
			\fi
			
			\ifdefined\resumoES
			\vspace{2em}\noindent\textbf{Resumen:} \resumoES\\[0.3em]
			\noindent \textbf{Palabras clave:} \keywordsES
			\fi
			
			\vspace{2em}
			\begin{flushleft}\small 
				\textbf{Como citar: } \renderComoCitarAutores~\monog.~\comoCitar~DOI: \doiArtigo.
			\end{flushleft}
			
		\end{tcolorbox}
		
	\end{revistaheaderenv}%
	\restoregeometry       % volta à geometria normal
	\thispagestyle{fancy}  % garante rodapé nesta primeira página
	\pagestyle{fancy}      % e nas seguintes
	\clearpage             % começa a página do artigo
	\capa@ativafalse       % desativa o overlay ANTES do shipout
}
\newcommand{\ccfooter}{%
	\vspace{0.7cm}%
	\singlespacing%
	\begin{tikzpicture}[remember picture, overlay]
		\node[anchor=south west, xshift=1.2cm, yshift=3.3cm] at (current page.south west)
		{\includegraphics[height=0.8cm]{figuras/cc.png}};
	\end{tikzpicture}%
}


%%%% traduzir caption de figuras e tabelas %%%%%%%%%%%%%%%%%

\addto\captionsbrazilian{
	% \renewcommand{\figurename}{Figura}
	\renewcommand{\tablename}{Tabela}
	\renewcommand{\refname}{REFERÊNCIAS}
}

\addto\captionsenglish{
	\renewcommand{\refname}{REFERENCES}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % % Citação direta 
\newenvironment{citacaodireta}{%
	\begin{list}{}{%
			\small
			\setlength{\leftmargin}{4cm}
			\singlespacing
		}
		\item\relax
	}{\end{list}}

% \begin{document}
	%   \lipsum[1]
	% 
	%   \begin{novoambiente}
		%     \lipsum[2]
		%   \end{novoambiente}
	% 
	%   \lipsum[3]
	% \end{document}
% --- Titulo de secao ---

\newcommand{\secao}[1]{\section{#1}}
\renewcommand{\section}{\@startsection
	{section} %Nome
	{0} %Nivel
	{0mm} %Indentacao
	{1.5\baselineskip} % Antes do paragrafo
	{1.5\baselineskip} % Depois do paragrafo
	{\noindent\bfseries\uppercase}} % Estilo - negrito e maiusculo

% Titulo de subsecao ---

\newcommand{\subsecao}[1]{\subsection{#1}}
\renewcommand{\subsection}{\@startsection
	{subsection} %Nome
	{1} %Nivel
	{0mm} %Indentacao
	{1.5\baselineskip} % Antes do paragrafo
	{1.5\baselineskip} % Depois do paragrafo
	{\noindent\bfseries}} % Estilo

% Titulo de subsubsecao ---

\newcommand{\subsubsecao}[1]{\subsubsection{#1}}
\renewcommand{\subsubsection}{\@startsection
	{subsubsection}% %Nome
	{2} %Nivel
	{0mm} %Indentacao
	{1.5\baselineskip} % Antes do paragrafo
	{1.5\baselineskip} % Depois do paragrafo
	{\noindent\bfseries\itshape}} % Estilo

%%%%%%%%%%%Título de Seção de 4° nível %%%%%%%%%%%%%%%%
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{3}
\newcounter {subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{\thesubsubsection .\@arabic\c@subsubsubsection}
\newcommand\subsubsubsection{\@startsection{subsubsubsection}{4}{\z@}%
	{1.5\baselineskip} % Antes do paragrafo
	{0.0\baselineskip}
	{\normalsize\bfseries\underbar}}
\newcommand*{\subsubsubsectionmark}[1]{\\ \par}

%%%%%%%%%%%Título de Seção de 5° nível %%%%%%%%%%%%%%%%

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{4}
\newcounter {subsubsubsubsection}[subsubsubsection]
\renewcommand\thesubsubsubsubsection{\thesubsubsubsection .\@arabic\c@subsubsubsubsection}
\newcommand\subsubsubsubsection{\@startsection{subsubsubsubsection}{5}{\z@}%
	{1.5\baselineskip} % Antes do paragrafo
	{0.0\baselineskip}
	{\normalsize}}
% \newcommand*\l@subsubsubsection{\@dottedtocline{3}{10.0em}{4.1em}}
\newcommand*{\subsubsubsubsectionmark}[1]{\\ \par}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Comando para citação individual de Autor e Ano
\newcommand{\citeAutorAno}[1]{\citeauthoronline{#1} (\citeyear{#1})}
\newcommand{\citeCitacao}[1]{\textsc{\citeauthoronline{#1}}, \citeyear{#1}} % para dentro do parentese ficar maisculo
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Recuo da primeira linha de cada parágrafo
%  \onehalfspace  % espaçamento 1.5 entre linhas
%  \setlength{\parindent}{1.25cm}

\usepackage{indentfirst}

%Desenhar figuras geometricas
\usepackage{tikz}

%%%%%%%%%%%%%%%%%%%%

% Sobrenome do primeiro autor
\newcommand{\primeiroAutorSobrenome}{%
	\StrCount{\autoresLista}{,}[\numAutores]
	\StrBefore{\autoresLista}{,}[\autorPrimeiro]%
	\StrBehind{\autorPrimeiro}{/}[\resto]%
	\StrBefore{\resto}{/}[\sobrenome]%
	\MakeUppercase{\sobrenome}%
}

\newcommand{\listaAutoresCabecalho}{%
	\StrCount{\autoresLista}{,}[\numAutores]%
	\ifnum\numAutores<5
	% até 4 autores: lista todos
	\def\tempLista{}%
	\foreach \autorEntry in \autoresLista {%
		\ifx\autorEntry\empty\else
		\StrBefore{\autorEntry}{/}[\nome]%
		\StrBehind{\autorEntry}{/}[\restoA]%
		\StrBefore{\restoA}{/}[\sobrenome]%
		\xdef\tempLista{\tempLista\MakeUppercase{\sobrenome}, \nome; }%
		\fi
	}%
	\StrGobbleRight{\tempLista}{2}%
	\else
	% mais de 4 autores: só o primeiro + et al.
	\primeiroAutorSobrenome{} \textit{et al.}%
	\fi
}

%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
%CABEÇALHO

%para margem do cabeçalho ficar do tamanho da margem do texto
\fancyheadoffset{0cm}

\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt} % remove linha padrão do cabeçalho

\setlength{\topmargin}{-1in}        % Remove margem padrão
\setlength{\headsep}{1.5cm} % ou 1.5cm, ajuste conforme desejar

% Cabeçalho com barra azul personalizada
\fancyhead[C]{%
	\begin{tcolorbox}[
		colback=headerblue,
		colframe=headerblue,
		boxrule=0pt,
		arc=0pt,
		left=10pt,
		right=10pt,
		top=2pt,
		bottom=2pt,
		width=\paperwidth,
		enlarge left by=-1in,
		enlarge right by=-1in,
		enlarge top by=-0.4cm, 
		height=1cm,
		valign=center,
		]
		\hspace{1em}%
		\textcolor{white}{\footnotesize \monog{} – \listaAutoresCabecalho}
	\end{tcolorbox}
}

%%%%%%%%%%%%%%%%%%%%

%\lhead{\footnotesize{\monog}} 

%\setlength\parindent{0pt}

\renewcommand{\footrulewidth}{0.5pt}
\rfoot [\footnotesize{\editorial~DOI: \href{\doiArtigo}{\pidArtigo}}]{\thepage}
\lfoot [\thepage]{\footnotesize{\editorial~DOI: \href{\doiArtigo}{\pidArtigo}}}

%%\renewcommand{\footrulewidth}{0pt} % Remove linha do rodapé
%\fancyhf{} % Limpa cabeçalhos e rodapés

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%AMBIENTE DE CITACAO
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newlength{\citacaoLeft}
\newlength{\citacaoRight}
\newlength{\citacaoVSpace}
\setlength{\citacaoLeft}{4cm}     % recuo à esquerda
\setlength{\citacaoRight}{0cm}    % recuo à direita
\setlength{\citacaoVSpace}{\baselineskip} % espaço acima/abaixo (ajuste aqui)
\newcommand{\citacaoFont}{\footnotesize} % fonte dentro da citação

\makeatletter
\newenvironment{citacao}{%
	\par\addvspace{\citacaoVSpace}% espaço ANTES
	\begingroup
	\citacaoFont
	% versão "tipo quote" com controle de espaçamentos
	\begin{list}{}{% margens e espaçamentos finos
			\leftmargin=\citacaoLeft
			\rightmargin=\citacaoRight
			\topsep=0pt \partopsep=0pt \itemsep=0pt \parsep=0pt
		}\item\relax
		\setlength{\parindent}{0pt}%
		\@ifpackageloaded{setspace}{\setstretch{1}}{}% força espaçamento simples se setspace estiver carregado
	}{%
	\end{list}%
	\par\endgroup
	\addvspace{\citacaoVSpace}% espaço DEPOIS
}

\makeatother